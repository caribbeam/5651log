{% extends 'log_kayit/partials/base_dashboard.html' %}
{% load i18n %}

{% block title %}{% trans "Doğrulama Oturumları" %} - {{ company.name }}{% endblock %}

{% block dashboard_content %}
<div class="sessions-list">
    <!-- Sayfa Başlığı -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0">
            <i class="fas fa-clipboard-list me-2"></i>{% trans "Doğrulama Oturumları" %}
            <small class="text-muted">- {{ company.name }}</small>
        </h1>
        <div>
            <a href="{% url 'log_verification:dashboard' company.slug %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>{% trans "Geri" %}
            </a>
            <a href="{% url 'log_verification:session_add' company.slug %}" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>{% trans "Yeni Doğrulama" %}
            </a>
        </div>
    </div>

    <!-- Oturumlar Tablosu -->
    <div class="card">
        <div class="card-header">
            <h5 class="card-title mb-0">
                <i class="fas fa-list me-2"></i>{% trans "Oturum Listesi" %}
            </h5>
        </div>
        <div class="card-body">
            {% if sessions %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>{% trans "Oturum Adı" %}</th>
                                <th>{% trans "Dosya" %}</th>
                                <th>{% trans "Durum" %}</th>
                                <th>{% trans "İlerleme" %}</th>
                                <th>{% trans "Kayıtlar" %}</th>
                                <th>{% trans "Oluşturulma" %}</th>
                                <th>{% trans "İşlemler" %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for session in sessions %}
                            <tr>
                                <td>
                                    <strong>{{ session.session_name }}</strong>
                                    {% if session.description %}
                                        <br><small class="text-muted">{{ session.description|truncatechars:50 }}</small>
                                    {% endif %}
                                </td>
                                <td>
                                    <small class="text-muted">{{ session.file_name }}</small>
                                    <br><span class="badge bg-info">{{ session.file_size|filesizeformat }}</span>
                                </td>
                                <td>
                                    {% if session.status == 'COMPLETED' %}
                                        <span class="badge bg-success">
                                            <i class="fas fa-check-circle me-1"></i>{% trans "Tamamlandı" %}
                                        </span>
                                    {% elif session.status == 'PROCESSING' %}
                                        <span class="badge bg-warning">
                                            <i class="fas fa-spinner fa-spin me-1"></i>{% trans "İşleniyor" %}
                                        </span>
                                    {% elif session.status == 'FAILED' %}
                                        <span class="badge bg-danger">
                                            <i class="fas fa-times-circle me-1"></i>{% trans "Başarısız" %}
                                        </span>
                                    {% elif session.status == 'CANCELLED' %}
                                        <span class="badge bg-secondary">
                                            <i class="fas fa-ban me-1"></i>{% trans "İptal Edildi" %}
                                        </span>
                                    {% else %}
                                        <span class="badge bg-info">
                                            <i class="fas fa-clock me-1"></i>{% trans "Beklemede" %}
                                        </span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="progress" style="height: 20px;">
                                        <div class="progress-bar 
                                            {% if session.status == 'COMPLETED' %}bg-success
                                            {% elif session.status == 'PROCESSING' %}bg-warning
                                            {% elif session.status == 'FAILED' %}bg-danger
                                            {% else %}bg-info{% endif %}" 
                                             role="progressbar" 
                                             style="width: {{ session.progress_percentage }}%"
                                             aria-valuenow="{{ session.progress_percentage }}" 
                                             aria-valuemin="0" aria-valuemax="100">
                                            {{ session.progress_percentage }}%
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        <strong>Toplam:</strong> {{ session.total_records }}<br>
                                        <strong>Doğrulanan:</strong> {{ session.verified_records }}<br>
                                        <strong>Başarısız:</strong> {{ session.failed_records }}<br>
                                        <strong>Değiştirilmiş:</strong> {{ session.modified_records }}
                                    </small>
                                </td>
                                <td>
                                    <small class="text-muted">
                                        {{ session.created_at|date:"d.m.Y H:i" }}
                                        <br>{{ session.created_at|timesince }} {% trans "önce" %}
                                    </small>
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <a href="{% url 'log_verification:session_detail' company.slug session.id %}" 
                                           class="btn btn-outline-primary" title="{% trans 'Detay' %}">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        {% if session.status == 'PENDING' %}
                                            <a href="{% url 'log_verification:session_start' company.slug session.id %}" 
                                               class="btn btn-outline-success" title="{% trans 'Başlat' %}">
                                                <i class="fas fa-play"></i>
                                            </a>
                                        {% endif %}
                                        {% if session.status == 'PROCESSING' %}
                                            <a href="{% url 'log_verification:session_cancel' company.slug session.id %}" 
                                               class="btn btn-outline-danger" title="{% trans 'İptal Et' %}">
                                                <i class="fas fa-stop"></i>
                                            </a>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-clipboard-list fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">{% trans "Henüz doğrulama oturumu bulunmuyor" %}</h5>
                    <p class="text-muted">{% trans "İlk doğrulama oturumunuzu oluşturmak için yukarıdaki butonu kullanın." %}</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
